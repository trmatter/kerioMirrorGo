<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{.ServiceName}} Status</title>
  <link href="/static/bootstrap/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/static/font/bootstrap-icons.min.css">
  <style>
    .section-title { display: flex; align-items: center; gap: 0.5em; }
    .ids-badge { font-size: 1.1em; }
    .footer { text-align: center; color: #888; margin-top: 2em; font-size: 0.95em; }
    @media (max-width: 600px) {
      .list-group-horizontal { flex-direction: column; }
    }
    .ids-disabled {
      opacity: 0.5;
      background: #f8f9fa !important;
      pointer-events: none;
    }
  </style>
</head>
<body class="bg-light">
<div class="container py-5">
  <!-- Информационная панель -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="alert alert-primary d-flex align-items-center shadow-sm" role="alert">
        <i class="bi bi-speedometer2 fs-2 me-3"></i>
        <div>
          <h4 class="alert-heading mb-1">{{.ServiceName}} <span class="fs-6 text-muted">Dashboard</span></h4>
          <div><i class="bi bi-clock-history"></i> <strong>Current time:</strong> {{.CurrentTime}}</div>
          <div><i class="bi bi-arrow-repeat"></i> <strong>Last update:</strong> {{.LastUpdate}}</div>
        </div>
      </div>
    </div>
  </div>
  <div class="row g-4">
    <div class="col-md-6">
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <h5 class="section-title mb-3"><i class="bi bi-gear"></i> Config</h5>
          <ul class="list-group list-group-flush mb-3">
            <li class="list-group-item"><strong>Database Path:</strong> {{.Config.DatabasePath}}</li>
            <li class="list-group-item"><strong>Log Path:</strong> {{.Config.LogPath}}</li>
            <li class="list-group-item"><strong>Proxy URL:</strong> {{.Config.ProxyURL}}</li>
            <li class="list-group-item"><strong>License Number:</strong>
              {{if not .Config.LicenseNumber}}
              <span class="text-warning">Not configured. Please add your license number in settings.</span>
              {{else}}
              {{.Config.LicenseNumber}}
              {{end}}
            </li>
          </ul>
          <h6 class="mt-3 mb-2 text-secondary"><i class="bi bi-arrow-repeat"></i> Retry Settings</h6>
          <ul class="list-group list-group-flush mb-3">
            <li class="list-group-item"><strong>Retry Count:</strong> {{.Config.RetryCount}}</li>
            <li class="list-group-item"><strong>Retry Delay (sec):</strong> {{.Config.RetryDelaySeconds}}</li>
          </ul>
          <h6 class="mt-3 mb-2 text-secondary"><i class="bi bi-globe2"></i> Geo & WebFilter</h6>
          <ul class="list-group list-group-flush">
            <li class="list-group-item"><strong>WebFilter API:</strong> {{.Config.WebFilterAPI}}</li>
            <li class="list-group-item"><strong>GeoIP4 URL:</strong> {{.Config.GeoIP4URL}}</li>
            <li class="list-group-item"><strong>GeoIP6 URL:</strong> {{.Config.GeoIP6URL}}</li>
            <li class="list-group-item"><strong>GeoLoc URL:</strong> {{.Config.GeoLocURL}}</li>
          </ul>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <h5 class="section-title mb-3"><i class="bi bi-shield-lock"></i> IDS Versions</h5>
          <ul class="list-group list-group mb-3 flex-wrap">
            {{range $k, $v := .IDSVersions}}
            {{ $enabled := true }}
            {{if eq $k "1"}}{{$enabled = $.Config.EnableIDS1}}{{end}}
            {{if eq $k "2"}}{{$enabled = $.Config.EnableIDS2}}{{end}}
            {{if eq $k "3"}}{{$enabled = $.Config.EnableIDS3}}{{end}}
            {{if eq $k "4"}}{{$enabled = $.Config.EnableIDS4}}{{end}}
            {{if eq $k "5"}}{{$enabled = $.Config.EnableIDS5}}{{end}}
            <li class="list-group-item d-flex align-items-center flex-column flex-md-row {{if not $enabled}}ids-disabled{{end}}">
              <div class="me-2">
                <strong>IDS{{$k}}:</strong>
                <span class="text-muted small">
                  {{if eq $k "1"}}IPS/IDS Snort (Windows версия)
                  {{else if eq $k "2"}}Списки скомпрометированных адресов
                  {{else if eq $k "3"}}IPS/IDS Snort (версия для Linux до 9.5)
                  {{else if eq $k "4"}}Базы данных GeoIP
                  {{else if eq $k "5"}}IPS/IDS Snort (версия для Linux с 9.5)
                    {{if $.Config.EnableSnortTemplate}}
                      + Snort Template
                      {{if not $.SnortTemplateSuccess}}<i class="bi bi-exclamation-triangle text-warning" title="Snort template update failed"></i>{{end}}
                    {{end}}
                  {{end}}
                  {{if not $enabled}}<span class="ms-2"><i class="bi bi-slash-circle"></i> <span class="small">Отключено</span></span>{{end}}
                </span>
              </div>
              <div class="ms-md-auto mt-2 mt-md-0">
                {{if not (index $.IDSSuccess $k)}}
                  <span class="badge bg-danger ms-2 ids-badge"><i class="bi bi-x-circle"></i> {{$v}}</span>
                {{else if eq $v 0}}
                  <span class="badge bg-danger ms-2 ids-badge"><i class="bi bi-x-circle"></i> {{$v}}</span>
                {{else}}
                  <span class="badge bg-success ms-2 ids-badge"><i class="bi bi-check-circle"></i> {{$v}}</span>
                {{end}}
              </div>
            </li>
            {{end}}
          </ul>
          <h5 class="section-title mb-3"><i class="bi bi-virus2"></i> Bitdefender Database Version</h5>
          <ul class="list-group list-group mb-3 flex-wrap">
            <li class="list-group-item d-flex align-items-center {{if not .Config.EnableBitdefender}}ids-disabled{{end}}">
              {{if not .BitdefenderSuccess}}
              <span class="badge bg-danger ms-2 ids-badge"><i class="bi bi-x-circle"></i> {{.BitdefenderVer}}</span>
              {{else if eq .BitdefenderVer 0}}
              <span class="badge bg-danger ms-2 ids-badge"><i class="bi bi-x-circle"></i> {{.BitdefenderVer}}</span>
              {{else}}
              <span class="badge bg-success ms-2 ids-badge"><i class="bi bi-check-circle"></i> {{.BitdefenderVer}}</span>
              {{end}}
              <span class="ms-2">
                <strong>Bitdefender</strong>
                {{if not .Config.EnableBitdefender}}<span class="ms-2"><i class="bi bi-slash-circle"></i> <span class="small">Отключено</span></span>{{end}}
              </span>
            </li>
          </ul>
          <h5 class="section-title mb-3"><i class="bi bi-grid-3x3-gap"></i> Shield Matrix Version</h5>
          <ul class="list-group list-group mb-3 flex-wrap">
            <li class="list-group-item d-flex align-items-center {{if not .Config.EnableShieldMatrix}}ids-disabled{{end}}">
              {{if not .ShieldMatrixSuccess}}
              <span class="badge bg-danger ms-2 ids-badge"><i class="bi bi-x-circle"></i> {{if .ShieldMatrixVersion}}{{.ShieldMatrixVersion}}{{else}}N/A{{end}}</span>
              {{else if not .ShieldMatrixVersion}}
              <span class="badge bg-warning ms-2 ids-badge"><i class="bi bi-exclamation-triangle"></i> N/A</span>
              {{else}}
              <span class="badge bg-success ms-2 ids-badge"><i class="bi bi-check-circle"></i> {{.ShieldMatrixVersion}}</span>
              {{end}}
              <span class="ms-2">
                <strong>Shield Matrix</strong> <span class="text-muted small">(Kerio 9.5+)</span>
                {{if not .Config.EnableShieldMatrix}}<span class="ms-2"><i class="bi bi-slash-circle"></i> <span class="small">Отключено</span></span>{{end}}
              </span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div class="d-flex flex-wrap gap-2 justify-content-center mb-4">
    <a href="/update" class="btn btn-warning btn-lg shadow"><i class="bi bi-arrow-repeat"></i> Manual Update</a>
    <a href="/logs" class="btn btn-secondary btn-lg shadow"><i class="bi bi-journal-text"></i> View Logs</a>
    <a href="/settings" class="btn btn-info btn-lg text-white shadow"><i class="bi bi-sliders"></i> Settings</a>
  </div>
  <div class="footer">
    &copy; {{.CurrentTime}} &mdash; <span class="text-primary">Kerio Mirror Go</span> | Powered by Go &amp; Bootstrap
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
